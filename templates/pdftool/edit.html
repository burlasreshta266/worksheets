{% extends 'pdftool/layout.html' %}
{% load static %}
{% block body %}

<main class="container-fluid mt-3 main-bg">

    <!-- error messages -->
   {% if messages %}
        <div class="container mt-3">
        {% for message in messages %}
            <div class="alert 
                {% if message.tags == 'error' %}alert-danger
                {% else %}alert-{{ message.tags }}
                {% endif %}
                alert-dismissible fade show" role="alert">

                {{ message }}

                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">‚®â</button>
            </div>
        {% endfor %}
        </div>
    {% endif %}

    <div class="row g-3">

        <!-- PDF Preview (Large Screens) / Full Width (Small Screens) -->
        <section id="edit-pdf-preview-area" class="col-lg-6 d-flex flex-column align-items-center">
            <div class="pdf-preview-embed-container" style="width: 95%; height: 70vh; max-height: 800px; border: 1px solid #ccc;">
                <embed src="{{ pdf_url }}" type="application/pdf" width="100%" height="100%" />
            </div>
        </section>



        <!-- Edit Controls -->
        <section id="edit-controls-area" class="col-lg-6 p-3">

            <!-- PDF Title -->
            <div class="d-flex justify-content-center align-items-center mb-4">
                <form action="{% url 'edit_pdf_name' %}" method="POST" class="d-flex align-items-center">
                {% csrf_token %}
                    <input type="text" value="{{ pdf_title }}" name="pdf_name" id="titleInput" class="form-control text-center pdf-title-input" disabled>
                    <button id="editTitleBtn" type="button" class="btn btn-sm edit-title-btn">‚úèÔ∏è</button>
                    <button id="saveTitleBtn" type="submit" class="btn btn-sm edit-title-btn d-none">‚úîÔ∏è</button>
                </form>
            </div>


            <!-- Filters -->
            <div class="card mb-4 edit-card">
                <div class="card-body">
                    <h5 class="card-title">Filters</h5>
                    <div class="d-flex flex-wrap gap-2 justify-content-between">
                        <button class="btn edit-filter-btn active">No filter</button>
                        <button class="btn edit-filter-btn">Greyscale</button>
                        <button class="btn edit-filter-btn">Light text</button>
                        <button class="btn edit-filter-btn">Defined</button>
                    </div>
                </div>
            </div>

            <!-- Action buttons -->
            <div class="d-flex gap-3 justify-content-between mb-4">
                <button class="btn edit-action-btn">‚úÇÔ∏è Crop</button>
                <button class="btn edit-action-btn">‚ûï Add pages</button>
                <button class="btn edit-action-btn">‚ùå Delete pages</button>
            </div>

            
            <div class="d-flex justify-content-center p-3">

                <!-- delete -->
                <form action="{% url 'delete_pdf' %}" method="POST" id="deletePdfForm">
                    {% csrf_token %}
                    <button type="submit" id="deletePdfBtn" class="btn btn-danger edit-bottom-btn">
                        üö´ Delete pdf
                    </button>
                </form>
                
                <!-- done / download -->
                <a href="{% url 'download_pdf' %}" id="download-btn" class="btn btn-success edit-bottom-btn">‚úÖ Done</a>
            </div>
        </section>

    </div>


<script>
document.addEventListener('DOMContentLoaded', function() {
    const editTitleBtn = document.getElementById('editTitleBtn');
    const saveTitleBtn = document.getElementById('saveTitleBtn');
    const titleInput = document.getElementById('titleInput');

    editTitleBtn.addEventListener('click', function(event) {
        event.preventDefault();
        titleInput.disabled = false;
        titleInput.focus();
        editTitleBtn.classList.add("d-none");
        saveTitleBtn.classList.remove("d-none");
    });

    // DELETE confirmation
    const deleteForm = document.getElementById('deletePdfForm');
    const deleteBtn  = document.getElementById('deletePdfBtn');

    deleteBtn.addEventListener('click', function(event) {
        event.preventDefault();  // prevent auto-submit

        const confirmed = confirm("Are you sure you want to delete this PDF? This action cannot be undone.");

        if (confirmed) {
            deleteForm.submit();
        }
    });
});
</script>


</main>
{% endblock %}